{{- if eq .chezmoi.os "linux" -}}
#!/usr/bin/env bash
set -euo pipefail

if ! command -v brew >/dev/null 2>&1; then
  echo "[chezmoi] Homebrew not found; skipping brew packages." >&2
  exit 0
fi

# Ensure `brew bundle` exists (provided by homebrew/bundle tap on some installs)
if ! brew help bundle >/dev/null 2>&1; then
  brew tap homebrew/bundle
fi

# Install declared packages (no automatic upgrades unless you change the list)
brew bundle --no-upgrade --file=/dev/stdin <<EOF
{{- range .packages.linux.brews }}
brew {{ . | quote }}
{{- end }}
{{- range .packages.linux.casks }}
cask {{ . | quote }}
{{- end }}
EOF
{{- end -}}